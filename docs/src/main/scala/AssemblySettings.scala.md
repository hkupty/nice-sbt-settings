## Sbt-assembly-related settings

This module defines settings to generate fat jar using [sbt-assembly plugin](https://github.com/softprops/assembly-sbt) and publish it,


```scala
package ohnosequences.sbt.nice

import sbt._
import Keys._

import sbtassembly._, AssemblyKeys._

import ResolverSettings.autoImport._
import ohnosequences.sbt.SbtS3Resolver.autoImport._

import com.amazonaws.services.s3.AmazonS3Client
import java.net.URI

case object AssemblySettings extends sbt.AutoPlugin {

  override def trigger = allRequirements
  override def requires =
    sbtassembly.AssemblyPlugin &&
    ResolverSettings

  case object autoImport {

    lazy val fatArtifactClassifier = settingKey[String]("Classifier suffix of the fat jar artifact")
    lazy val fatArtifactUrl = settingKey[String]("URL of the published fat artifact")

    lazy val fatArtifactUpload = taskKey[Unit]("Uploads fat-jar generated by sbt-assembly to fatArtifactUrl")
  }
  import autoImport._
```

### Settings

```scala
  override def projectSettings: Seq[Setting[_]] = Seq(
    // suffix for the fat artifact:
    fatArtifactClassifier := "fat",
    // turning off tests in assembly:
    test in assembly := {},

    // mvn: "[organisation]/[module]_[scalaVersion]/[revision]/[artifact]-[revision]-[classifier].[ext]"
    // ivy: "[organisation]/[module]_[scalaVersion]/[revision]/[type]s/[artifact]-[classifier].[ext]"
    fatArtifactUrl := {
      val isMvn = publishMavenStyle.value
      val scalaV = "_"+scalaBinaryVersion.value
      val module = moduleName.value + scalaV
      val artifact = Seq(
        if (isMvn) "" else "jars/",
        module,
        if (isMvn) s"-${version.value}" else "",
        s"-${fatArtifactClassifier.value}",
        ".jar"
      ).mkString

      Seq(
        publishS3Resolver.value.url,
        organization.value,
        module,
        version.value,
        artifact
      ).mkString("/")
    },

    fatArtifactUpload := fatArtifactUploadTask.value
  )

  def fatArtifactUploadTask: DefTask[Unit] = Def.task {
    lazy val fatJar = assembly.value

    lazy val uri = new URI(fatArtifactUrl.value).normalize
    lazy val bucket = uri.getHost
    lazy val key    = uri.getPath.stripPrefix("/")

    streams.value.log.info(s"Publishing assembled artifact to [${uri.toString}]...")
    new AmazonS3Client(s3credentials.value).putObject(bucket, key, fatJar)

    // NOTE: This is just another way to upload an object
    // TODO: Would be nice to have some progress reporting, but the default one doesn't do anything "/
    // val transfer = new TransferManager(s3credentials.value).upload(bucket, key, fatJar)
    // transfer.addProgressListener(new com.amazonaws.event.ProgressTracker())
    // transfer.waitForCompletion()
  }

}

```




[main/scala/AssemblySettings.scala]: AssemblySettings.scala.md
[main/scala/Git.scala]: Git.scala.md
[main/scala/JavaOnlySettings.scala]: JavaOnlySettings.scala.md
[main/scala/MetadataSettings.scala]: MetadataSettings.scala.md
[main/scala/package.scala]: package.scala.md
[main/scala/release/commands.scala]: release/commands.scala.md
[main/scala/release/keys.scala]: release/keys.scala.md
[main/scala/release/parsers.scala]: release/parsers.scala.md
[main/scala/release/tasks.scala]: release/tasks.scala.md
[main/scala/ReleasePlugin.scala]: ReleasePlugin.scala.md
[main/scala/ResolverSettings.scala]: ResolverSettings.scala.md
[main/scala/ScalaSettings.scala]: ScalaSettings.scala.md
[main/scala/StatikaBundleSettings.scala]: StatikaBundleSettings.scala.md
[main/scala/Version.scala]: Version.scala.md
[main/scala/VersionSettings.scala]: VersionSettings.scala.md
[main/scala/WartRemoverSettings.scala]: WartRemoverSettings.scala.md